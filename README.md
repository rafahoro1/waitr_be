# waitr -BE

## What is this?
This is an implementation (back-end part) of the [https://github.com/WaitrInc/coding-challenge/blob/master/coding_challenge.md]()

I choose to implement the 'Delivery Review Service' according to the spec in [https://github.com/WaitrInc/coding-challenge/blob/master/specs/delivery_reviews.yaml]()

## Build & development
As usual, first run **npm install** to install every dependency.

Then you have several scripts:

 - **npm run mock**: Add data to the DB (the DB will be dropped and re-created). Run first, so the DB has some data when you start the FrontEnd.
 - **npm start**: to start the server. Will listen on port 8000
 - **npm test**: to run the tests (you must run 'npm run mock' before, so the DB has the mock data in it).
 - **npm run cover**: to run test coverage

About coverage: the only method that is not covered is "mongoose.connection.on('disconnected',...)". Every other method is 
tested at least once.


## Implementation
The backend was implemented using [https://github.com/restify/node-restify](Restify) and the base code was actually 
created by the [http://yeoman.io/](Yeoman) generator [https://github.com/krakenjs/generator-swaggerize](generator-swaggerize)

The database used is [www.mongodb.com](mongo), with [http://mongoosejs.com/]() ODM. 

I tried to use [https://github.com/simonguest/swagger-mongoose](swagger-mongoose) to generate the schemas, but did not 
like the results (and was getting some exceptions parsing the given yaml file) so I just created the schemas manaually.
                                                                                                           
You can see the code generated by generator-swaggerize, as it's the one in the 'initial commit' of the repository. All other code was written by me.


                                                                                                           
After some clarifications (thanks Travis!!) about the challenge here are some notes about my implementation:

 - In the original 'delivery_reviews.yaml' I fixed a typo on line 59: /drivers/{driverId}/deliveries/{deliveryId}/review:' --> /drivers/{driverId}*/*deliveries/{deliveryId}/review'
 - The handler for '/drivers/{driverId}/reviews' returns not only the reviews of the given driver (DriverReviews schema) but also the reviews for a delivery the given driver delivered (DeliveryReviews schema)
 
## Directory/File structure
 - **./test/fixtures**: contains the script to reset the DB and populate with mock-data (necessary for the tests)
 - **./tests/drivers**: contains the tests for all the handlers
 - **./data**: contains the DB related files. Including mongoose's schema definitions.
 - **./handlers**: contains the resource handlers. Ie the methods that will be finally called by a connecting client
 - **./server.js**: The main script. Starts a server to listen on port 8000, and using Swaggerize and Restify, redirects any connection to the right Handler
 - **./config/swagger.yaml** the swagger spec file provided for the challenge (with some typos fixes) 
  
## ToDo
 As usual, there are many improvements for this implementation that were left of.

  - Use [https://github.com/lorenwest/node-config](node-config) or similar to remove hardcoded values (server port, DB connection, CORS related string, etc)
  - Most collections have no resource handler to populate it, and instead are populated using the fixtures.js script
  - The DeliveryReview schema, stores a String as ID for the delivery. As the specifications does not require an actual 
  Delivery collection and there is no resource handler to add data to such collection (nor to retrieve it), the collection 
  was not created and instead a String added as ID in the DeliveryReview schema. A full implementation will create the
  Delivery collection.
  - The DeliveryReview schema, has a 'driver_id' field. A better implementation will be 
  to have that value in a second schema (ie: DeliveryDriver) that links a Delivery to a Driver. As that data came
  through the POST handler but was not necessary to use, I just added it to the DeliveryReview schema meanwhile.
  - Better error handling/log.
  
  
